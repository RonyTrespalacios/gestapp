<div class="data-table-container" #container>
  <!-- Modal de confirmación -->
  <app-modal 
    [title]="'Confirmar'"
    [message]="'¿Estás seguro de que deseas eliminar esta transacción?'"
    [type]="'error'"
    [show]="showConfirmModal"
    [showConfirmButtons]="true"
    (confirm)="confirmDelete()"
    (close)="cancelDelete()">
  </app-modal>

  <!-- Modal de mensajes -->
  <app-modal 
    [title]="modalTitle"
    [message]="modalMessage"
    [type]="modalType"
    [show]="showModal"
    (close)="closeModal()">
  </app-modal>

  <!-- Modal de carga de archivos -->
  <app-file-upload-modal
    [show]="showUploadModal"
    [initialFile]="pendingFile"
    (close)="closeUploadModal()"
    (fileSelected)="onFileSelectedFromModal($event)">
  </app-file-upload-modal>

  <div class="header-section">
    <h2>Historial financiero</h2>
    
    <div class="actions">
      <div class="download-section">
        <select [(ngModel)]="exportFormat" class="format-select">
          <option value="csv">CSV</option>
          <option value="xlsx">XLSX</option>
        </select>
        <button (click)="downloadData()" class="btn btn-download">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="7 10 12 15 17 10" />
            <line x1="12" y1="15" x2="12" y2="3" />
          </svg>
          <span>Descargar historial</span>
        </button>
      </div>
      
      <div class="upload-section">
        <button 
          (click)="openUploadModal()" 
          class="btn btn-secondary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25" />
            <polyline points="16 16 12 12 8 16" />
            <line x1="12" y1="12" x2="12" y2="21" />
          </svg>
          <span>Subir historial</span>
        </button>
      </div>
    </div>

    <div class="display-limit-section">
      <label for="displayLimit" class="limit-label">Mostrar:</label>
      <select 
        id="displayLimit"
        [(ngModel)]="displayLimit" 
        (ngModelChange)="onDisplayLimitChange()"
        class="format-select">
        <option [ngValue]="5">Últimas 5</option>
        <option [ngValue]="10">Últimas 10</option>
        <option [ngValue]="15">Últimas 15</option>
        <option [ngValue]="20">Últimas 20</option>
        <option [ngValue]="45">Últimas 45</option>
        <option [ngValue]="50">Últimas 50</option>
        <option [ngValue]="-1">Todas</option>
      </select>
    </div>
  </div>

  <div class="records-info" *ngIf="!isLoading && allTransactions.length > 0">
    <span class="records-text">
      {{ displayedTransactions.length }} registros mostrados de {{ allTransactions.length }} registros totales
    </span>
  </div>

  <div class="table-wrapper" *ngIf="!isLoading && transactions.length > 0">
    <table class="data-table">
      <thead>
        <tr>
          <th class="col-fecha">Fecha</th>
          <th>Categoria</th>
          <th class="col-descripcion">Descripcion</th>
          <th>Tipo</th>
          <th>Monto</th>
          <th>Medio</th>
          <th class="col-observaciones">Observaciones</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let transaction of transactions">
          <td class="col-fecha" [attr.data-label]="'Fecha'">{{ transaction.fecha }}</td>
          <td [attr.data-label]="'Categoria'">{{ transaction.categoria }}</td>
          <td class="col-descripcion" [attr.data-label]="'Descripcion'">{{ transaction.descripcion }}</td>
          <td [attr.data-label]="'Tipo'">{{ transaction.tipo }}</td>
          <td [attr.data-label]="'Monto'">{{ formatAmount(transaction.monto) }}</td>
          <td [attr.data-label]="'Medio'">{{ transaction.medio }}</td>
          <td class="col-observaciones" [attr.data-label]="'Observaciones'">{{ transaction.observaciones || '-' }}</td>
          <td [attr.data-label]="'Acciones'">
            <button 
              (click)="deleteTransaction(transaction.id!)" 
              class="btn btn-delete">
              X
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="loading" *ngIf="isLoading">
    <div class="loading-dots">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>

  <div class="no-data" *ngIf="!isLoading && transactions.length === 0">
    <p>No hay datos</p>
  </div>
</div>


